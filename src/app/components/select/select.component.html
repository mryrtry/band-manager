<div class="custom-select-container">
  @if (label) {
    <label class="custom-select-label">{{ label }}</label>
  }

  <div
    class="custom-select"
    [class.opened]="isOpen"
    [class.disabled]="disabled"
    [class.focused]="isOpen"
    (click)="toggle()"
    tabindex="0"
    role="combobox"
    aria-haspopup="listbox"
    [attr.aria-expanded]="isOpen"
    [attr.aria-disabled]="disabled"
  >
    <div class="custom-select-selector">
      <span class="custom-select-value">
        @if (searchable && isOpen) {
          <input
            type="text"
            class="custom-select-search"
            [(ngModel)]="searchQuery"
            (click)="$event.stopPropagation()"
            placeholder="{{ selectedLabel }}"
            [autofocus]="true"
          >
        } @else {
          {{ selectedLabel }}
        }
      </span>

      <span class="custom-select-arrow">
        <svg width="12" height="8" viewBox="0 0 12 8">
          <path d="M1 1l5 5 5-5" stroke="currentColor" stroke-width="1" fill="none"/>
        </svg>
      </span>
    </div>

    @if (isOpen) {
      <div class="custom-select-dropdown">
        <div class="custom-select-options" role="listbox">
          @for (option of filteredOptions; track option.value; let i = $index) {
            <div
              #option
              class="custom-select-option"
              [class.selected]="option.value === selectedValue"
              [class.focused]="i === focusedIndex"
              [class.disabled]="option.disabled"
              (click)="!option.disabled && selectOption(option)"
              role="option"
              [attr.aria-selected]="option.value === selectedValue"
            >
              {{ option.label }}
            </div>
          }

          @if (filteredOptions.length === 0) {
            <div class="custom-select-no-results">
              Ничего не найдено
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>
